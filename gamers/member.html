<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Member Portal</title>
  <style>
    body { font-family: Arial, sans-serif; background:#101820; color:#fff; margin:0; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; text-align:center; background-image:url('ps5_theme.jpg'); background-size:cover; }
    .container { background:rgba(0,0,0,0.6); padding:20px; border-radius:12px; }
    input, button { padding:10px; margin:5px; border-radius:8px; border:none; }
    button { background:#1e90ff; color:#fff; cursor:pointer; }
    button:hover { background:#63b3ed; }
    .status { margin-top:10px; font-weight:bold; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Member Portal</h1>
    <div id="loginSection">
      <input id="memberId" placeholder="Enter Member ID">
      <button onclick="login()">Login</button>
    </div>
    <div id="portal" style="display:none;">
      <p>Welcome, <span id="mid"></span></p>
      <p>Remaining Time: <span id="time">0</span> seconds</p>
      <button onclick="startSession()">Start 1h Session</button>
      <button onclick="logout()">Logout</button>
      <div class="status" id="status"></div>
    </div>
  </div>
  <script>
    let memberId = localStorage.getItem('memberId');
    if(memberId) { showPortal(memberId); fetchTime(); }
    function login() {
      memberId = document.getElementById('memberId').value;
      if(memberId) { localStorage.setItem('memberId', memberId); showPortal(memberId); fetchTime(); }
    }
    function logout() {
      localStorage.removeItem('memberId'); location.reload();
    }
    async function fetchTime() {
      setStatus("⏳ Loading...");
      let res = await fetch('/.netlify/functions/getMember?member_id=' + memberId);
      let data = await res.json();
      document.getElementById('time').innerText = data.remaining_seconds;
      setStatus("✅ Synced");
    }
    async function startSession() {
      setStatus("⏳ Starting session...");
      let res = await fetch('/.netlify/functions/startSession', {
        method:'POST', body:JSON.stringify({ member_id: memberId, seconds:3600 })
      });
      let data = await res.json();
      document.getElementById('time').innerText = data.remaining_seconds;
      setStatus("✅ Session Started");
    }
    function showPortal(id) {
      document.getElementById('loginSection').style.display='none';
      document.getElementById('portal').style.display='block';
      document.getElementById('mid').innerText = id;
    }
    function setStatus(msg) { document.getElementById('status').innerText = msg; }
  </script>
</body>
</html>
